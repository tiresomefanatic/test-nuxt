import{x as w,y as h,a as _,g as $,z as C,i as S,A as I,B as j,o,C as E,w as f,c as i,q as c,D as l,p as g,E as A,F as B,G as D,r as m,l as N,I as O,d as z,b,n as p,t as y}from"./DpbXZn14.js";import{u as F}from"./B9wLN67B.js";const P={base:"",background:"bg-white dark:bg-gray-900",divide:"divide-y divide-gray-200 dark:divide-gray-800",ring:"ring-1 ring-gray-200 dark:ring-gray-800",rounded:"rounded-lg",shadow:"shadow",body:{base:"",background:"",padding:"px-4 py-5 sm:p-6"},header:{base:"",background:"",padding:"px-4 py-5 sm:px-6"},footer:{base:"",background:"",padding:"px-4 py-4 sm:px-6"}},R=w(h.ui.strategy,h.ui.card,P),T=$({inheritAttrs:!1,props:{as:{type:String,default:"div"},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(e){const{ui:a,attrs:s}=F("card",C(e,"ui"),R),r=S(()=>I(j(a.value.base,a.value.rounded,a.value.divide,a.value.ring,a.value.shadow,a.value.background),e.class));return{ui:a,attrs:s,cardClass:r}}});function U(e,a,s,r,t,n){return o(),E(B(e.$attrs.onSubmit?"form":e.as),A({class:e.cardClass},e.attrs),{default:f(()=>[e.$slots.header?(o(),i("div",{key:0,class:c([e.ui.header.base,e.ui.header.padding,e.ui.header.background])},[l(e.$slots,"header")],2)):g("",!0),e.$slots.default?(o(),i("div",{key:1,class:c([e.ui.body.base,e.ui.body.padding,e.ui.body.background])},[l(e.$slots,"default")],2)):g("",!0),e.$slots.footer?(o(),i("div",{key:2,class:c([e.ui.footer.base,e.ui.footer.padding,e.ui.footer.background])},[l(e.$slots,"footer")],2)):g("",!0)]),_:3},16,["class"])}const V=_(T,[["render",U]]),q={class:"flex min-h-screen items-center justify-center"},G={key:0,class:"text-red-500"},J={key:1},M={class:"text-sm text-gray-500"},x={__name:"callback",setup(e){const a=D(),s=m(null),r=m("");return N(async()=>{try{const{code:t,state:n}=a.query;r.value=`Code: ${t}, State: ${n}`;const d=localStorage.getItem("github_oauth_state");if(!d||d!==n)throw new Error("Invalid state parameter");if(!t)throw new Error("No authorization code found in URL");const u=await fetch("/api/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});if(!u.ok){const v=await u.json().catch(()=>({}));throw new Error(v.message||"Failed to exchange code for token")}const k=await u.json();localStorage.setItem("github_token",k.access_token),localStorage.removeItem("github_oauth_state"),O("/",{replace:!0})}catch(t){console.error("Authentication error:",t),s.value=t.message||"Failed to authenticate with GitHub",r.value=`Error: ${t.message}`}}),(t,n)=>{const d=V;return o(),i("div",q,[z(d,null,{header:f(()=>n[0]||(n[0]=[b("h3",{class:"text-xl font-semibold"},"Authenticating...",-1)])),default:f(()=>[p(s)?(o(),i("p",G,y(p(s)),1)):(o(),i("p",J,"Please wait while we complete your authentication...")),b("p",M,"Debug info: "+y(p(r)),1)]),_:1})])}}};export{x as default};
